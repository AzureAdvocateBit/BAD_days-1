<!DOCTYPE html>
<html>
<!--custom header -->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width initial-scale=1">

  <title> BADays (Bioinformatics Awareness Days)</title>
  <meta name="description" content="Bioinformatics Awareness Days (BAD days)">


  <link rel="shortcut icon" href="http://localhost:4000/BAD_days/images/dna.png" >

  <!-- Style sheets -->
  <!--Material bootstrap -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.3.0/css/mdb.min.css" rel="stylesheet" medial ="all">

  <!-- Font awesome -->
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet" media="all">

  <!-- Boostrap-->
  <link rel="stylesheet" href="/BAD_days/css/main.css">


  <!-- URL -->
  <link rel="canonical" href="http://localhost:4000/BAD_days/dimensionality ReductionR.html">


  <!-- The various JS scripts used in the website -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
  <script src="https://use.fontawesome.com/ff95ae1185.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
  integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
  crossorigin="anonymous"></script>

<!-- add after bootstrap.min.js -->
<script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v0.4.1/dist/bootstrap-toc.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.3.0/js/mdb.min.js"></script>
<link src="/BAD_days/js/custom-scripts.js">


<!-- Loading mathjax macro -->
<!-- Load mathjax -->
    <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
    <!-- MathJax configuration -->
    <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"] ],
            displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
            processEscapes: true,
            processEnvironments: true
        },
        // Center justify equations in code and markdown cells. Elsewhere
        // we use CSS to left justify single line equations in code cells.
        displayAlign: 'center',
        "HTML-CSS": {
            styles: {'.MathJax_Display': {"margin": 0}},
            linebreaks: { automatic: true }
        }
    });
    </script>

</head>


<!-- scroller for TOC-->
<body data-spy="scroll" data-target="#toc">

<!-- sidebar-->
  <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p>Bioinformatics Awareness Days (BAD days)</p>

    <p> Developed by Luisa Cutillo and the <a href='http://rse.shef.ac.uk'> RSE team
    </a> at the University of Sheffield</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/BAD_days/">Home</a>

    

    
    
      
        
        <!-- Note you need to prepend the site.baseurl always-->
          <a class="sidebar-nav-item"
          href="/BAD_days/1-outline/">Day 1</a>
        
      
    
      
        
        <!-- Note you need to prepend the site.baseurl always-->
          <a class="sidebar-nav-item"
          href="/BAD_days/2-outline/">Day 2</a>
        
      
    
      
        
        <!-- Note you need to prepend the site.baseurl always-->
          <a class="sidebar-nav-item"
          href="/BAD_days/3-outline/">Day 3</a>
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
    
      
        
      
    
      
    


    <a class="sidebar-nav-item" href="https://github.com/trallard/BAD_days">GitHub repository</a>
  </nav>

  <div class="sidebar-item">
    <p>
      The University of Sheffield &copy; 2017. CC-BY
    </p>
  </div>
</div>


<!--main content needs to be in a wrap for
when the sidebar is displayed-->
  <div class='wrap'>

<!-- navbar -->
  <!--Top navigation bar-->

    <nav class="navbar navbar-inverse">
      <div class="container-fluid">

        <a class="navbar-brand" href="/BAD_days/index.html"> </a>

        </div>
      </div>
    </nav>

</div>
<div class='wrap'>
  <div class="container">
    <div class="row">

<!--- Main content--->
      <div class="col-sm-8">
        <main>
          <h1 id="bad-day-2-dimensionality-reduction">BAD DAY 2: Dimensionality reduction</h1>

<h1 id="pca">1. PCA</h1>
<p>(for more examples see
http://manuals.bioinformatics.ucr.edu/home/R_BioCondManual )</p>

<p>Principal Component Analysis (PCA) is a data reduction technique that allows to
simplify multidimensional data sets to a lower dimensional space ( tipically
using 2 or 3 dimensions) for a first broad visual analysis of the data (via
plotting and visual variance analysis).</p>

<p>The <code class="highlighter-rouge">prcomp( )</code> and <code class="highlighter-rouge">princomp( )</code> R functions are devoted to PCA.</p>

<p>The BioConductor library <code class="highlighter-rouge">pcaMethods</code> provides many additional PCA functions.</p>

<p>We are going to use the IRIS data set to demonstrate the use of PCA.</p>

<p>This data was used to show that these measurements could be used to
differentiate between species of irises.</p>

<p>This data set contains the sepal/petal length and width measurements in
centimeters for 50 flowers from each of 3 species of iris.</p>

<p>The Iris species are:  <strong>setosa, versicolor, and virginica.</strong></p>

<p><br /></p>
<font color="#00bcd4"> In [2]: </font>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># Setting the working directory
</span><span class="n">bad2dir</span><span class="o">=</span><span class="w"> </span><span class="n">getwd</span><span class="p">()</span><span class="w">
</span><span class="n">setwd</span><span class="p">(</span><span class="n">bad2dir</span><span class="p">)</span></code></pre></figure>

<p><br /></p>
<font color="#00bcd4"> In [3]: </font>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># Loading the data and getting a summary
</span><span class="n">data</span><span class="p">(</span><span class="n">iris</span><span class="p">)</span><span class="w">
</span><span class="n">str</span><span class="p">(</span><span class="n">iris</span><span class="p">);</span><span class="w">
</span><span class="n">summary</span><span class="p">(</span><span class="n">iris</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">])</span><span class="w">

</span><span class="err">#</span><span class="nf">dim</span><span class="p">(</span><span class="n">iris</span><span class="p">)</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>  Sepal.Length    Sepal.Width     Petal.Length    Petal.Width   
 Min.   :4.300   Min.   :2.000   Min.   :1.000   Min.   :0.100  
 1st Qu.:5.100   1st Qu.:2.800   1st Qu.:1.600   1st Qu.:0.300  
 Median :5.800   Median :3.000   Median :4.350   Median :1.300  
 Mean   :5.843   Mean   :3.057   Mean   :3.758   Mean   :1.199  
 3rd Qu.:6.400   3rd Qu.:3.300   3rd Qu.:5.100   3rd Qu.:1.800  
 Max.   :7.900   Max.   :4.400   Max.   :6.900   Max.   :2.500  
</code></pre>
</div>

<p>Now we will create a scatterplot of the dimensions against each other for the
three species.</p>

<p><br /></p>
<font color="#00bcd4"> In [4]: </font>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># Custom chosen colours
</span><span class="n">colours</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s1">'steelblue3'</span><span class="p">,</span><span class="w">  </span><span class="s1">'mediumpurple'</span><span class="p">,</span><span class="w"> </span><span class="s1">'midnightblue'</span><span class="p">)</span><span class="w">

</span><span class="c1"># Plotting
</span><span class="n">pairs</span><span class="p">(</span><span class="n">iris</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">],</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Iris Data"</span><span class="p">,</span><span class="w"> </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">19</span><span class="p">,</span><span class="w">
      </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">colours</span><span class="p">[</span><span class="nf">unclass</span><span class="p">(</span><span class="n">iris</span><span class="o">$</span><span class="n">Species</span><span class="p">)],</span><span class="w"> </span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">colnames</span><span class="p">(</span><span class="n">iris</span><span class="p">))</span><span class="w">


</span><span class="c1"># adding legend
</span><span class="n">par</span><span class="p">(</span><span class="n">xpd</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="n">legend</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">levels</span><span class="p">(</span><span class="n">iris</span><span class="o">$</span><span class="n">Species</span><span class="p">),</span><span class="w"> </span><span class="n">pt.bg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">colours</span><span class="p">,</span><span class="w">
       </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">21</span><span class="p">,</span><span class="w"> </span><span class="n">bty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"n"</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">)</span></code></pre></figure>

<p><img src="http://localhost:4000/BAD_days/notebooks/dimensionality%20ReductionR_files/dimensionality%20ReductionR_6_0.png" alt="png" /></p>

<p>PCA is used to create linear combinations of the original data that capture as
much information in the original data as possible.
We will use the <code class="highlighter-rouge">prcomp</code> function.</p>

<ul>
  <li>
    <p>If we work with standardized data (mean 0 std 1) we need to calculate the
principal components through correlation matrix.</p>
  </li>
  <li>
    <p>If we work with raw data we need to calculate the principal components through
the covariance matrix.</p>
  </li>
</ul>

<p>It is good practice to standardize our variables when these have different units
and have very different variances. If they are in the same units either of the
alteratives is appropriate.</p>

<p>In our example all variables are measured in centimetres but we will use the
correlation matrix for simplicity’s sake.</p>

<p>First, we are going to examine the variability of all the numeric values</p>

<p><br /></p>
<font color="#00bcd4"> In [5]: </font>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">sapply</span><span class="p">(</span><span class="n">iris</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">],</span><span class="n">var</span><span class="p">)</span></code></pre></figure>

<dl class="dl-horizontal">
	<dt>Sepal.Length</dt>
		<dd>0.685693512304251</dd>
	<dt>Sepal.Width</dt>
		<dd>0.189979418344519</dd>
	<dt>Petal.Length</dt>
		<dd>3.11627785234899</dd>
	<dt>Petal.Width</dt>
		<dd>0.581006263982103</dd>
</dl>

<p><br /></p>
<font color="#00bcd4"> In [6]: </font>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="nf">range</span><span class="p">(</span><span class="n">sapply</span><span class="p">(</span><span class="n">iris</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">],</span><span class="n">var</span><span class="p">))</span></code></pre></figure>

<ol class="list-inline">
	<li>0.189979418344519</li>
	<li>3.11627785234899</li>
</ol>

<p>Maybe this range of variability is big in this context.
Thus, we will use the correlation matrix
For this, we must standardize our variables using the  <code class="highlighter-rouge">scale()</code> function:</p>

<p><br /></p>
<font color="#00bcd4"> In [7]: </font>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">iris.stand</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">scale</span><span class="p">(</span><span class="n">iris</span><span class="p">[,</span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">]))</span><span class="w">
</span><span class="n">sapply</span><span class="p">(</span><span class="n">iris.stand</span><span class="p">,</span><span class="n">sd</span><span class="p">)</span><span class="w"> </span><span class="c1">#now, standard deviations are 1
</span><span class="w">
</span><span class="err">#</span><span class="n">sapply</span><span class="p">(</span><span class="n">iris.stand</span><span class="p">,</span><span class="n">mean</span><span class="p">)</span><span class="w"> </span><span class="err">#</span><span class="n">now</span><span class="p">,</span><span class="w"> </span><span class="n">standard</span><span class="w"> </span><span class="n">deviations</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="m">1</span></code></pre></figure>

<dl class="dl-horizontal">
	<dt>Sepal.Length</dt>
		<dd>1</dd>
	<dt>Sepal.Width</dt>
		<dd>1</dd>
	<dt>Petal.Length</dt>
		<dd>1</dd>
	<dt>Petal.Width</dt>
		<dd>1</dd>
</dl>

<p>If we use the <code class="highlighter-rouge">prcomp()</code> function, we indicate <code class="highlighter-rouge">scale=TRUE</code> to use the
correlation matrix.</p>

<p><br /></p>
<font color="#00bcd4"> In [8]: </font>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">pca</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">prcomp</span><span class="p">(</span><span class="n">iris.stand</span><span class="p">,</span><span class="w"> </span><span class="n">scale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">T</span><span class="p">)</span><span class="w">

</span><span class="c1">#similar with princomp(): princomp(iris.stand, cor=T)
</span><span class="n">pca</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>Standard deviations:
[1] 1.7083611 0.9560494 0.3830886 0.1439265

Rotation:
                    PC1         PC2        PC3        PC4
Sepal.Length  0.5210659 -0.37741762  0.7195664  0.2612863
Sepal.Width  -0.2693474 -0.92329566 -0.2443818 -0.1235096
Petal.Length  0.5804131 -0.02449161 -0.1421264 -0.8014492
Petal.Width   0.5648565 -0.06694199 -0.6342727  0.5235971
</code></pre>
</div>

<p><br /></p>
<font color="#00bcd4"> In [9]: </font>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">summary</span><span class="p">(</span><span class="n">pca</span><span class="p">)</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>Importance of components:
                          PC1    PC2     PC3     PC4
Standard deviation     1.7084 0.9560 0.38309 0.14393
Proportion of Variance 0.7296 0.2285 0.03669 0.00518
Cumulative Proportion  0.7296 0.9581 0.99482 1.00000
</code></pre>
</div>

<p>This gives us the standard deviation of each component, and the proportion of
variance explained by each component.
The standard deviation is stored in (see <code class="highlighter-rouge">str(pca)</code>):</p>

<p><br /></p>
<font color="#00bcd4"> In [10]: </font>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">pca</span><span class="o">$</span><span class="n">sdev</span></code></pre></figure>

<ol class="list-inline">
	<li>1.70836114932762</li>
	<li>0.956049408486857</li>
	<li>0.38308860015839</li>
	<li>0.143926496617611</li>
</ol>

<p>Usually the trend is to select up to 3 components (for visualization purposes)
but we can have an indication on how many principal components should be
retained.</p>

<p>Usually a scree plot helps making a decision. In R we can use the <code class="highlighter-rouge">screeplot()</code>
function:</p>

<p><br /></p>
<font color="#00bcd4"> In [11]: </font>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">#plot of variance of each PCA.
#It will be useful to decide how many principal components should be retained.
</span><span class="n">screeplot</span><span class="p">(</span><span class="n">pca</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"lines"</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'mediumpurple'</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">)</span></code></pre></figure>

<p><img src="http://localhost:4000/BAD_days/notebooks/dimensionality%20ReductionR_files/dimensionality%20ReductionR_19_0.png" alt="png" /></p>

<p>This plot together with the values of the Proportion of Variance and Cumulative
Proportion obtained by means of <code class="highlighter-rouge">summary(pca)</code> suggests that we can retain just
the first 2 components accounting for over 95% of the variation in the original
data!</p>

<p><br /></p>
<font color="#00bcd4"> In [12]: </font>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">#retreive loadings for the principal components:
</span><span class="n">pca</span><span class="o">$</span><span class="n">rotation</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">princomp</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="n">pca</span><span class="o">$</span><span class="n">loadings</span></code></pre></figure>

<table class="table-responsive table-striped">
<thead><tr><th></th><th scope="col">PC1</th><th scope="col">PC2</th><th scope="col">PC3</th><th scope="col">PC4</th></tr></thead>
<tbody>
	<tr><th scope="row">Sepal.Length</th><td> 0.5210659 </td><td>-0.37741762</td><td> 0.7195664 </td><td> 0.2612863 </td></tr>
	<tr><th scope="row">Sepal.Width</th><td>-0.2693474 </td><td>-0.92329566</td><td>-0.2443818 </td><td>-0.1235096 </td></tr>
	<tr><th scope="row">Petal.Length</th><td> 0.5804131 </td><td>-0.02449161</td><td>-0.1421264 </td><td>-0.8014492 </td></tr>
	<tr><th scope="row">Petal.Width</th><td> 0.5648565 </td><td>-0.06694199</td><td>-0.6342727 </td><td> 0.5235971 </td></tr>
</tbody>
</table>

<p>The weights of the PC1 are all similar but the one associated to Sepal.Width
variable (it is negative).
This one principal component accounts for over 72% of the variability in the
data.</p>

<p>All weights on the second principal component are negative. Thus the PC2 might
seem considered as an overall size measurement.  This component explain the 23%
of the variability.</p>

<p>The following figure show the first two components and the observations on the
same diagram, which helps to interpret the factorial axes while looking at
observations location.</p>

<p>The first component discriminate on one side the Sepal.Width and on the other
side the rest of variables (see biplot).
According to the second component, When the iris has larger sepal and petal
values than average, the PC2 will be smaller than average.</p>

<p><br /></p>
<font color="#00bcd4"> In [13]: </font>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">unique</span><span class="p">(</span><span class="n">iris</span><span class="o">$</span><span class="n">Species</span><span class="p">)</span><span class="w">
</span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">iris</span><span class="o">$</span><span class="n">Species</span><span class="p">))</span><span class="m">+1</span></code></pre></figure>

<ol class="list-inline">
	<li>setosa</li>
	<li>versicolor</li>
	<li>virginica</li>
</ol>

<ol class="list-inline">
	<li>2</li>
	<li>3</li>
	<li>4</li>
</ol>

<p><br /></p>
<font color="#00bcd4"> In [14]: </font>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># biplot of first two principal components
</span><span class="n">biplot</span><span class="p">(</span><span class="n">pca</span><span class="p">,</span><span class="w"> </span><span class="n">cex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.8</span><span class="p">)</span><span class="w">
</span><span class="n">abline</span><span class="p">(</span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">lty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">8</span><span class="p">)</span></code></pre></figure>

<p><img src="http://localhost:4000/BAD_days/notebooks/dimensionality%20ReductionR_files/dimensionality%20ReductionR_24_0.png" alt="png" /></p>

<p><br /></p>
<font color="#00bcd4"> In [15]: </font>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">plot</span><span class="p">(</span><span class="n">pca</span><span class="o">$</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">colours</span><span class="p">,</span><span class="w"> </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">19</span><span class="p">)</span><span class="w">

</span><span class="n">legend</span><span class="p">(</span><span class="s2">"topright"</span><span class="p">,</span><span class="w"> </span><span class="n">legend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">unique</span><span class="p">(</span><span class="n">iris</span><span class="o">$</span><span class="n">Species</span><span class="p">),</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">colours</span><span class="p">,</span><span class="w"> </span><span class="n">pch</span><span class="o">=</span><span class="w"> </span><span class="m">19</span><span class="p">)</span></code></pre></figure>

<p><img src="http://localhost:4000/BAD_days/notebooks/dimensionality%20ReductionR_files/dimensionality%20ReductionR_25_0.png" alt="png" /></p>

<h1 id="tsne-and-comparison-with-pca">2. TSNE and comparison with PCA</h1>

<p>The t-Distributed Stochastic Neighbor Embedding (t-SNE algorithm), by Laurens
van der Maaten and Geoffrey Hinton, is a NON LINEAR dimensionality reduction
algorithm.
It enebles to represent high-dimensional data in two or three dimensions and
allows visualization via scatter plots.</p>

<p>Barnes-Hut-SNE is a further improvement of the algorithm by Laurens van der
Maaten, which uses Barnes-Hut approximations to significantly improve
computational speed (O(N log N) instead of O(N2)). This makes it feasible to
apply the algorithm to larger data sets.</p>

<p>We will follow the example proposed oh github https://github.com/lmweber/Rtsne-
example using “Rtsne”, a package by Jesse Krijthe provides an R wrapper function
for the C++ implementation of the Barnes-Hut-SNE algorithm.</p>

<p>The data set used in this example is the healthy human bone marrow data set
“Marrow1”.</p>

<p><br /></p>
<font color="#00bcd4"> In [16]: </font>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># fist of all, just as an example, apply tsne on the IRIS dataset
</span><span class="n">library</span><span class="p">(</span><span class="n">Rtsne</span><span class="p">)</span><span class="w"> </span><span class="c1"># Load package
</span><span class="n">iris_unique</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">unique</span><span class="p">(</span><span class="n">iris</span><span class="p">)</span><span class="w"> </span><span class="c1"># Remove duplicates
</span><span class="n">set.seed</span><span class="p">(</span><span class="m">42</span><span class="p">)</span><span class="w"> </span><span class="c1"># Sets seed for reproducibility
</span><span class="n">tsne_out</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">Rtsne</span><span class="p">(</span><span class="n">as.matrix</span><span class="p">(</span><span class="n">iris_unique</span><span class="p">[,</span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">]))</span><span class="w"> </span><span class="c1"># Run TSNE
</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">tsne_out</span><span class="o">$</span><span class="n">Y</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">colours</span><span class="p">,</span><span class="w"> </span><span class="n">pch</span><span class="o">=</span><span class="w"> </span><span class="m">19</span><span class="p">)</span><span class="w"> </span><span class="c1"># Plot the result
</span><span class="w">
</span><span class="n">legend</span><span class="p">(</span><span class="s2">"bottomright"</span><span class="p">,</span><span class="w"> </span><span class="n">legend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">unique</span><span class="p">(</span><span class="n">iris</span><span class="o">$</span><span class="n">Species</span><span class="p">),</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">colours</span><span class="p">,</span><span class="w"> </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">19</span><span class="p">)</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>Error in library(Rtsne): there is no package called ‘Rtsne’
Traceback:


1. library(Rtsne)

2. stop(txt, domain = NA)
</code></pre>
</div>

<p>Here we will follow  the example on GITHUB  https://github.com/lmweber/Rtsne-
example.
The Marrow1 dataset is made of cells from different cell populations (types). We
will see how tsne will be able to  group them as distinct clusters of points in
the 2-dimensional projection. There is clear visual separation between clusters.
Amir et al. (2013) also independently verified the interpretation of the
clusters using “manual gating” methods (visual inspection of 2-dimensional
scatter plots), confirming that several clusters represent well-known cell types
from immunology.</p>

<p><br /></p>
<font color="#00bcd4"> In [17]: </font>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">#install flowCore package from Bioconductor (to read FCS files)
</span><span class="n">source</span><span class="p">(</span><span class="s2">"https://bioconductor.org/biocLite.R"</span><span class="p">)</span><span class="w">
</span><span class="n">biocLite</span><span class="p">(</span><span class="s2">"flowCore"</span><span class="p">)</span><span class="w">

</span><span class="c1"># install Rtsne package from CRAN (R implementation of Barnes-Hut-SNE algorithm)
</span><span class="w">
</span><span class="n">install.packages</span><span class="p">(</span><span class="s2">"Rtsne"</span><span class="p">)</span><span class="w">

</span><span class="c1"># load packages
</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">flowCore</span><span class="p">)</span></code></pre></figure>

<p><br /></p>
<font color="#00bcd4"> In [21]: </font>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">exprs</span><span class="p">(</span><span class="n">read.FCS</span><span class="p">(</span><span class="s2">"./Rtsne-example-master/data/visne_marrow1.fcs"</span><span class="p">,</span><span class="w"> </span><span class="n">transformation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">))</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="w">

</span><span class="n">unname</span><span class="p">(</span><span class="n">colnames</span><span class="p">(</span><span class="n">data</span><span class="p">))</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="n">isotope</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">marker</span><span class="w"> </span><span class="p">(</span><span class="n">protein</span><span class="p">)</span><span class="w"> </span><span class="n">names</span></code></pre></figure>

<table class="table-responsive table-striped">
<thead><tr><th scope="col">Event#</th><th scope="col">Time</th><th scope="col">Cell Length</th><th scope="col">191-DNA</th><th scope="col">193-DNA</th><th scope="col">115-CD45</th><th scope="col">110,111,112,114-CD3</th><th scope="col">139-CD45RA</th><th scope="col">141-pPLCgamma2</th><th scope="col">142-CD19</th><th scope="col">⋯</th><th scope="col">166-IkBalpha</th><th scope="col">167-CD38</th><th scope="col">168-pH3</th><th scope="col">170-CD90</th><th scope="col">169-pP38</th><th scope="col">171-pBtk/Itk</th><th scope="col">172-pS6</th><th scope="col">174-pSrcFK</th><th scope="col">176-pCREB</th><th scope="col">175-pCrkL</th></tr></thead>
<tbody>
	<tr><td> 22933     </td><td> 42448     </td><td>14.39525   </td><td>321.2244   </td><td> 434.9970  </td><td>142.39886  </td><td> 18.5329704</td><td>117.579620 </td><td> 4.8356605 </td><td>50.8025017 </td><td>⋯          </td><td> 2.019981  </td><td>32.1595116 </td><td>14.3242693 </td><td> 8.78977966</td><td>53.843872  </td><td>82.910294  </td><td> 6.8211913 </td><td> 5.774820  </td><td>12.3001671 </td><td> 1.4769655 </td></tr>
	<tr><td>228744     </td><td>667323     </td><td>41.27012   </td><td>209.3467   </td><td> 563.6180  </td><td> 50.66235  </td><td>  0.2076987</td><td> 19.171650 </td><td>-1.3943130 </td><td>10.0177841 </td><td>⋯          </td><td> 4.779097  </td><td>-0.5546998 </td><td> 1.5282539 </td><td>-0.26177970</td><td>17.979921  </td><td> 1.054635  </td><td> 5.0797348 </td><td> 7.080018  </td><td>-1.7290312 </td><td>-1.0569905 </td></tr>
	<tr><td>230819     </td><td>549730     </td><td>28.91957   </td><td>829.5733   </td><td>1408.7177  </td><td>503.61078  </td><td>294.2422791</td><td>  5.135233 </td><td> 0.8516778 </td><td>-0.1638297 </td><td>⋯          </td><td>12.946030  </td><td>47.7583084 </td><td>18.4628849 </td><td> 0.54432803</td><td>37.236912  </td><td>38.177971  </td><td>79.4033279 </td><td> 2.626387  </td><td>23.7090988 </td><td>-1.4266791 </td></tr>
	<tr><td>131780     </td><td>359184     </td><td>26.11232   </td><td>643.0649   </td><td> 992.3835  </td><td>178.37289  </td><td>359.2935181</td><td> 79.340591 </td><td>-0.2172089 </td><td> 5.7050629 </td><td>⋯          </td><td>24.191151  </td><td>49.7774315 </td><td> 5.1872330 </td><td>-0.07430215</td><td> 6.879214  </td><td>11.992647  </td><td>-0.2527083 </td><td> 9.006838  </td><td>-0.6766897 </td><td>-0.4470886 </td></tr>
	<tr><td> 32212     </td><td> 56694     </td><td>36.61685   </td><td>713.0907   </td><td>1131.0656  </td><td> 34.13390  </td><td>-12.1336746</td><td>  1.377896 </td><td> 3.1527698 </td><td>-0.2193382 </td><td>⋯          </td><td> 3.426270  </td><td>42.7431793 </td><td>-0.8187979 </td><td> 9.73161793</td><td>10.562280  </td><td>26.534126  </td><td>-0.7640409 </td><td>50.811363  </td><td>16.6444397 </td><td> 3.9240763 </td></tr>
	<tr><td>403958     </td><td>834589     </td><td>29.39848   </td><td>638.0286   </td><td> 968.7856  </td><td>288.91412  </td><td> 65.9604187</td><td>  6.649710 </td><td>-0.7853550 </td><td>-1.4377729 </td><td>⋯          </td><td> 1.359477  </td><td>89.9450684 </td><td>15.9464016 </td><td> 3.46092296</td><td> 4.090930  </td><td>51.456581  </td><td> 7.6963782 </td><td>28.520178  </td><td> 5.2173581 </td><td>-0.3729125 </td></tr>
</tbody>
</table>

<ol class="list-inline">
	<li>'Event#'</li>
	<li>'Time'</li>
	<li>'Cell Length'</li>
	<li>'191-DNA'</li>
	<li>'193-DNA'</li>
	<li>'115-CD45'</li>
	<li>'110,111,112,114-CD3'</li>
	<li>'139-CD45RA'</li>
	<li>'141-pPLCgamma2'</li>
	<li>'142-CD19'</li>
	<li>'144-CD11b'</li>
	<li>'145-CD4'</li>
	<li>'146-CD8'</li>
	<li>'148-CD34'</li>
	<li>'150-pSTAT5'</li>
	<li>'147-CD20'</li>
	<li>'152-Ki67'</li>
	<li>'154-pSHP2'</li>
	<li>'151-pERK1/2'</li>
	<li>'153-pMAPKAPK2'</li>
	<li>'156-pZAP70/Syk'</li>
	<li>'158-CD33'</li>
	<li>'160-CD123'</li>
	<li>'159-pSTAT3'</li>
	<li>'164-pSLP-76'</li>
	<li>'165-pNFkB'</li>
	<li>'166-IkBalpha'</li>
	<li>'167-CD38'</li>
	<li>'168-pH3'</li>
	<li>'170-CD90'</li>
	<li>'169-pP38'</li>
	<li>'171-pBtk/Itk'</li>
	<li>'172-pS6'</li>
	<li>'174-pSrcFK'</li>
	<li>'176-pCREB'</li>
	<li>'175-pCrkL'</li>
</ol>

<p><br /></p>
<font color="#00bcd4"> In [22]: </font>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># select markers to use in calculation of t-SNE projection
# CD11b, CD123, CD19, CD20, CD3, CD33, CD34, CD38, CD4, CD45, CD45RA, CD8, CD90
# (see Amir et al. 2013, Supplementary Tables 1 and 2)
</span><span class="w">
</span><span class="n">colnames_proj</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">unname</span><span class="p">(</span><span class="n">colnames</span><span class="p">(</span><span class="n">data</span><span class="p">))[</span><span class="nf">c</span><span class="p">(</span><span class="m">11</span><span class="p">,</span><span class="w"> </span><span class="m">23</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="m">16</span><span class="p">,</span><span class="w"> </span><span class="m">7</span><span class="p">,</span><span class="w"> </span><span class="m">22</span><span class="p">,</span><span class="w"> </span><span class="m">14</span><span class="p">,</span><span class="w"> </span><span class="m">28</span><span class="p">,</span><span class="w"> </span><span class="m">12</span><span class="p">,</span><span class="w"> </span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="m">8</span><span class="p">,</span><span class="w"> </span><span class="m">13</span><span class="p">,</span><span class="w"> </span><span class="m">30</span><span class="p">)]</span><span class="w">
</span><span class="n">colnames_proj</span><span class="w">  </span><span class="c1"># check carefully!
</span><span class="w">

</span><span class="c1"># arcsinh transformation
# (see Amir et al. 2013, Online Methods, "Processing of mass cytometry data")
</span><span class="w">
</span><span class="n">asinh_scale</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">5</span><span class="w">
</span><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">asinh</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">asinh_scale</span><span class="p">)</span><span class="w">  </span><span class="c1"># transforms all columns! including event number etc
</span><span class="w">

</span><span class="c1"># subsampling
</span><span class="w">
</span><span class="n">nsub</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">10000</span><span class="w">
</span><span class="n">set.seed</span><span class="p">(</span><span class="m">123</span><span class="p">)</span><span class="w">  </span><span class="c1"># set random seed
</span><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="n">sample</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="n">nrow</span><span class="p">(</span><span class="n">data</span><span class="p">),</span><span class="w"> </span><span class="n">nsub</span><span class="p">),</span><span class="w"> </span><span class="p">]</span><span class="w">

</span><span class="nf">dim</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></code></pre></figure>

<ol class="list-inline">
	<li>'144-CD11b'</li>
	<li>'160-CD123'</li>
	<li>'142-CD19'</li>
	<li>'147-CD20'</li>
	<li>'110,111,112,114-CD3'</li>
	<li>'158-CD33'</li>
	<li>'148-CD34'</li>
	<li>'167-CD38'</li>
	<li>'145-CD4'</li>
	<li>'115-CD45'</li>
	<li>'139-CD45RA'</li>
	<li>'146-CD8'</li>
	<li>'170-CD90'</li>
</ol>

<ol class="list-inline">
	<li>10000</li>
	<li>36</li>
</ol>

<p><br /></p>
<font color="#00bcd4"> In [23]: </font>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># prepare data for Rtsne
</span><span class="w">
</span><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data</span><span class="p">[,</span><span class="w"> </span><span class="n">colnames_proj</span><span class="p">]</span><span class="w">      </span><span class="c1"># select columns to use
</span><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="o">!</span><span class="n">duplicated</span><span class="p">(</span><span class="n">data</span><span class="p">),</span><span class="w"> </span><span class="p">]</span><span class="w">  </span><span class="c1"># remove rows containing duplicate values within rounding
</span><span class="w">
</span><span class="nf">dim</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></code></pre></figure>

<ol class="list-inline">
	<li>9902</li>
	<li>13</li>
</ol>

<p><br /></p>
<font color="#00bcd4"> In [24]: </font>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># Exporting the subsample data in TXT format
</span><span class="w">
</span><span class="n">file</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="s2">"./Rtsne-example-master/data/viSNE_Marrow1_nsub"</span><span class="p">,</span><span class="w"> </span><span class="n">nsub</span><span class="p">,</span><span class="s2">".txt"</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="p">)</span><span class="w">
</span><span class="n">write.table</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">file</span><span class="p">,</span><span class="w"> </span><span class="n">row.names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="n">quote</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"\t"</span><span class="p">)</span></code></pre></figure>

<p>Running the Rtsne (Barnes-Hut_SNE algorithm) without PCA step (see Amir et al.
2013, Online Methods, “viSNE analysis”)</p>

<p><br /></p>
<font color="#00bcd4"> In [25]: </font>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">set.seed</span><span class="p">(</span><span class="m">123</span><span class="p">)</span><span class="w">  </span><span class="c1"># set random seed
</span><span class="n">rtsne_out</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">Rtsne</span><span class="p">(</span><span class="n">as.matrix</span><span class="p">(</span><span class="n">data</span><span class="p">),</span><span class="w"> </span><span class="n">pca</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="n">verbose</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>Error in eval(expr, envir, enclos): could not find function "Rtsne"
Traceback:
</code></pre>
</div>

<p><br /></p>
<font color="#00bcd4"> In [26]: </font>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># plot 2D t-SNE projection
</span><span class="w">
</span><span class="c1"># Uncomment the lines below if you want to save to a separate .PNG file
# file_plot &lt;- paste("./Rtsne-example-master/plots/Rtsne_viSNE_Marrow1_nsub", nsub, ".png", sep = "")
# png(file_plot, width = 900, height = 900)
</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">rtsne_out</span><span class="o">$</span><span class="n">Y</span><span class="p">,</span><span class="w"> </span><span class="n">asp</span><span class="w"> </span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">21</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'mediumpurple'</span><span class="p">,</span><span class="w">
     </span><span class="n">cex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.75</span><span class="p">,</span><span class="w"> </span><span class="n">cex.axis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.25</span><span class="p">,</span><span class="w"> </span><span class="n">cex.lab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.25</span><span class="p">,</span><span class="w"> </span><span class="n">cex.main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.5</span><span class="p">,</span><span class="w">
     </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"t-SNE dimension 1"</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"t-SNE dimension 2"</span><span class="p">,</span><span class="w">
     </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"2D t-SNE projection"</span><span class="p">)</span><span class="w">

</span><span class="c1"># Uncomment if saving to a pgn file
</span><span class="err">#</span><span class="n">dev</span><span class="p">(</span><span class="n">off</span><span class="p">)</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>Error in plot(rtsne_out$Y, asp = 1, pch = 21, col = "mediumpurple", cex = 0.75, : object 'rtsne_out' not found
Traceback:


1. plot(rtsne_out$Y, asp = 1, pch = 21, col = "mediumpurple", cex = 0.75,
 .     cex.axis = 1.25, cex.lab = 1.25, cex.main = 1.5, xlab = "t-SNE dimension 1",
 .     ylab = "t-SNE dimension 2", main = "2D t-SNE projection")
</code></pre>
</div>

<h3 id="compare-to-pca">Compare to PCA</h3>

<p><br /></p>
<font color="#00bcd4"> In [27]: </font>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">pca_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">princomp</span><span class="p">(</span><span class="n">as.matrix</span><span class="p">(</span><span class="n">data</span><span class="p">))</span><span class="o">$</span><span class="n">scores</span><span class="p">[,</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">]</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">pca_data</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="w"> </span><span class="s1">'steelblue3'</span><span class="p">)</span><span class="w">

</span><span class="err">#</span><span class="n">text</span><span class="p">(</span><span class="n">pca_iris</span><span class="p">,</span><span class="w"> </span><span class="n">labels</span><span class="o">=</span><span class="n">iris</span><span class="o">$</span><span class="n">Species</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">iris</span><span class="o">$</span><span class="n">Species</span><span class="p">])</span></code></pre></figure>

<p><img src="http://localhost:4000/BAD_days/notebooks/dimensionality%20ReductionR_files/dimensionality%20ReductionR_38_0.png" alt="png" /></p>

<h1 id="about-the-interpretation-of-tsne">About the interpretation of TSNE</h1>
<p>SOME EXAMPLES FROM
https://gist.github.com/mikelove/74bbf5c41010ae1dc94281cface90d32
on the delicate interpretation of tsne when the underlyng structure of the data
is LINEAR</p>

<p>Explore tsne on linear data. First install (if needed) and load the required
packages.</p>

<p><br /></p>
<font color="#00bcd4"> In [37]: </font>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="n">rafalib</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">RColorBrewer</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">Rtsne</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">tsne</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">pracma</span><span class="p">)</span></code></pre></figure>

<p><br /></p>
<font color="#00bcd4"> In [42]: </font>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">))</span><span class="w">

</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">2</span><span class="o">:</span><span class="m">5</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">set.seed</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w">
  </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">runif</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="m">-1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">
  </span><span class="n">cols</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">brewer.pal</span><span class="p">(</span><span class="m">11</span><span class="p">,</span><span class="w"> </span><span class="s2">"PuOr"</span><span class="p">)[</span><span class="nf">as.integer</span><span class="p">(</span><span class="n">cut</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="m">11</span><span class="p">))]</span><span class="w">
  </span><span class="n">ortho</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">randortho</span><span class="p">(</span><span class="n">m</span><span class="p">)</span><span class="w">
  </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cbind</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="n">ncol</span><span class="o">=</span><span class="n">m</span><span class="m">-1</span><span class="p">,</span><span class="n">nrow</span><span class="o">=</span><span class="n">n</span><span class="p">))</span><span class="w"> </span><span class="o">%*%</span><span class="w"> </span><span class="n">ortho</span><span class="w">
  </span><span class="n">res</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tsne</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="w">
  </span><span class="n">plot</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="n">cols</span><span class="p">,</span><span class="w"> </span><span class="n">pch</span><span class="o">=</span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="o">=</span><span class="s2">"tsne"</span><span class="p">)</span><span class="w">
  </span><span class="n">res</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">Rtsne</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="w">
  </span><span class="n">plot</span><span class="p">(</span><span class="n">res</span><span class="o">$</span><span class="n">Y</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="n">cols</span><span class="p">,</span><span class="w"> </span><span class="n">pch</span><span class="o">=</span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="o">=</span><span class="s2">"Rtsne"</span><span class="p">)</span><span class="w">
</span><span class="p">}</span></code></pre></figure>

<p><img src="http://localhost:4000/BAD_days/notebooks/dimensionality%20ReductionR_files/dimensionality%20ReductionR_42_1.png" alt="png" /></p>

<p><img src="http://localhost:4000/BAD_days/notebooks/dimensionality%20ReductionR_files/dimensionality%20ReductionR_42_3.png" alt="png" /></p>

<p><img src="http://localhost:4000/BAD_days/notebooks/dimensionality%20ReductionR_files/dimensionality%20ReductionR_42_4.png" alt="png" /></p>

<p><img src="http://localhost:4000/BAD_days/notebooks/dimensionality%20ReductionR_files/dimensionality%20ReductionR_42_5.png" alt="png" /></p>

<p><br /></p>
<font color="#00bcd4"> In [41]: </font>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">n</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">200</span><span class="w">
</span><span class="n">m</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">40</span><span class="w">
</span><span class="n">set.seed</span><span class="p">(</span><span class="m">1</span><span class="p">)</span><span class="w">

</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">runif</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="m">-1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">

</span><span class="n">bigpar</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="n">mar</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">3</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">1</span><span class="p">))</span><span class="w">

</span><span class="n">cols</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">brewer.pal</span><span class="p">(</span><span class="m">11</span><span class="p">,</span><span class="w"> </span><span class="s2">"PuOr"</span><span class="p">)[</span><span class="nf">as.integer</span><span class="p">(</span><span class="n">cut</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="m">11</span><span class="p">))]</span><span class="w">

</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="n">n</span><span class="p">),</span><span class="w"> </span><span class="n">ylim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">-1</span><span class="p">,</span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="n">yaxt</span><span class="o">=</span><span class="s2">"n"</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span><span class="w">
</span><span class="n">col</span><span class="o">=</span><span class="n">cols</span><span class="p">,</span><span class="w"> </span><span class="n">pch</span><span class="o">=</span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="o">=</span><span class="s2">"underlying data"</span><span class="p">)</span><span class="w">

</span><span class="n">ortho</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">randortho</span><span class="p">(</span><span class="n">m</span><span class="p">)</span><span class="w">

</span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cbind</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="n">ncol</span><span class="o">=</span><span class="n">m</span><span class="m">-1</span><span class="p">,</span><span class="n">nrow</span><span class="o">=</span><span class="n">n</span><span class="p">))</span><span class="w"> </span><span class="o">%*%</span><span class="w"> </span><span class="n">ortho</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">[,</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">],</span><span class="w"> </span><span class="n">asp</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="n">cols</span><span class="p">,</span><span class="w"> </span><span class="n">pch</span><span class="o">=</span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="o">=</span><span class="s2">"embed in higher dim"</span><span class="p">)</span><span class="w">

</span><span class="n">res</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tsne</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="n">cols</span><span class="p">,</span><span class="w"> </span><span class="n">pch</span><span class="o">=</span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="o">=</span><span class="s2">"t-SNE"</span><span class="p">)</span><span class="w">
</span><span class="n">bigpar</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="n">mar</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">3</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">))</span><span class="w">

</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">2</span><span class="o">:</span><span class="m">5</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">set.seed</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w">
    </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">runif</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="m">-1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">
    </span><span class="n">cols</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">brewer.pal</span><span class="p">(</span><span class="m">11</span><span class="p">,</span><span class="w"> </span><span class="s2">"PuOr"</span><span class="p">)[</span><span class="nf">as.integer</span><span class="p">(</span><span class="n">cut</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="m">11</span><span class="p">))]</span><span class="w">
    </span><span class="n">ortho</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">randortho</span><span class="p">(</span><span class="n">m</span><span class="p">)</span><span class="w">
    </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cbind</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="n">ncol</span><span class="o">=</span><span class="n">m</span><span class="m">-1</span><span class="p">,</span><span class="n">nrow</span><span class="o">=</span><span class="n">n</span><span class="p">))</span><span class="w"> </span><span class="o">%*%</span><span class="w"> </span><span class="n">ortho</span><span class="w">
    </span><span class="n">res</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tsne</span><span class="p">(</span><span class="n">X</span><span class="p">);</span><span class="w">
    </span><span class="n">plot</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="n">cols</span><span class="p">,</span><span class="w"> </span><span class="n">pch</span><span class="o">=</span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span><span class="w">
</span><span class="p">}</span></code></pre></figure>

<p><img src="http://localhost:4000/BAD_days/notebooks/dimensionality%20ReductionR_files/dimensionality%20ReductionR_43_1.png" alt="png" /></p>

<p><img src="http://localhost:4000/BAD_days/notebooks/dimensionality%20ReductionR_files/dimensionality%20ReductionR_43_2.png" alt="png" /></p>

<p><br /></p>
<font color="#00bcd4"> In [None]: </font>


        </main>
      </div>

      <div class="col-sm-1">
      </div>
      <!-- TOC sidebar, which will move to the top on a small screen -->
      <div class="col-sm-3 container-toc">
        <nav id="toc" data-spy="affix" data-toggle="toc"></nav>
      </div>
    </div>
  </div>
</div>

<label for="sidebar-checkbox" class="sidebar-toggle"></label>

</body>


</html>
