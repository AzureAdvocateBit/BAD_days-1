<!DOCTYPE html>
<html>
  <! custom header >
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width initial-scale=1">

  <title> BADays (Bioinformatics Awareness Days)</title>
  <meta name="description" content="A tutorial for anyone wanting to use SageMathCloud for teaching">

  <link rel="stylesheet" href="/BAD_days/css/main.css">

  <link rel="canonical" href="http://localhost:4000/BAD_days/T-test.html">

  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet" media="all">

  <!-- The various JS scripts used in the website -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
  <script src="https://use.fontawesome.com/ff95ae1185.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
  integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
  crossorigin="anonymous"></script>

</head>

  
    <nav class="navbar navbar-inverse">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-2">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">BAD Days</a>
        </div>
      </div>
    </nav>


  <div class='container'>
    <div class="row">
      <div class='col-sm-10'>
        <h1 id="bad-day-1--t-test">BAD Day 1 : T-test</h1>

<h2 id="loading-the-data-set">1. Loading the data set</h2>

<div class="language-R highlighter-rouge"><pre class="highlight"><code><span class="n">require</span><span class="p">(</span><span class="n">multtest</span><span class="p">)</span><span class="w">
</span><span class="n">data</span><span class="p">(</span><span class="n">golub</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>Loading required package: multtest
Warning message in library(package, lib.loc = lib.loc, character.only = TRUE, logical.return = TRUE, :
“there is no package called ‘multtest’”Warning message in data(golub):
“data set ‘golub’ not found”
</code></pre>
</div>

<p>We will be usig the Gene Expression dataset from Golub et al (1999).</p>

<p>Gene expression data (3051 genes and 38 tumor mRNA samples) from the leukemia microarray study of Golub et al. (1999). Pre-processing was done as described in Dudoit et al. (2002). The R code for pre-processing is available in the file ../doc/golub.R.
Source: Golub et al. (1999). Molecular classification of cancer: class discovery and class prediction by gene expression monitoring, Science, Vol. 286:531-537. http://www-genome.wi.mit.edu/MPR/ .</p>

<div class="language-R highlighter-rouge"><pre class="highlight"><code><span class="n">golub.expr</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">golub</span><span class="w">

</span><span class="c1"># preliminar view of the data
</span><span class="n">head</span><span class="p">(</span><span class="n">golub.expr</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>Error in eval(expr, envir, enclos): object 'golub' not found
Traceback:
</code></pre>
</div>

<p><code class="highlighter-rouge">golub.names</code> is a matrix containing the names of the 3051
 genes contained in <code class="highlighter-rouge">golub</code>. The three columns correspond to:
<code class="highlighter-rouge">index, ID and name</code></p>

<div class="language-R highlighter-rouge"><pre class="highlight"><code><span class="n">row.names</span><span class="p">(</span><span class="n">golub.expr</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">golub.gnames</span><span class="p">[,</span><span class="m">3</span><span class="p">]</span><span class="w">
</span></code></pre>
</div>

<p><code class="highlighter-rouge">golub.cl</code> is a numeric vector indicating the tumor class, 27 acute lymphoblastic leukemia (ALL) cases (code 0) and 11 acute myeloid leukemia (AML) cases (code 1).</p>

<div class="language-R highlighter-rouge"><pre class="highlight"><code><span class="n">colnames</span><span class="p">(</span><span class="n">golub.expr</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">golub.cl</span><span class="w">
</span></code></pre>
</div>

<p>Now we need to set the sample sizes</p>

<div class="language-R highlighter-rouge"><pre class="highlight"><code><span class="n">n.ALL</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">27</span><span class="w">
</span><span class="n">n.AML</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">11</span><span class="w">

</span><span class="n">cancer.type</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="nf">rep</span><span class="p">(</span><span class="s1">'ALL'</span><span class="p">,</span><span class="w"> </span><span class="n">n.ALL</span><span class="p">),</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="s1">'AML'</span><span class="p">,</span><span class="w"> </span><span class="n">n.AML</span><span class="p">))</span><span class="w">
</span></code></pre>
</div>

<p>Adding the cancer type to the column name, for the display</p>

<div class="language-R highlighter-rouge"><pre class="highlight"><code><span class="n">colnames</span><span class="p">(</span><span class="n">golub.expr</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cancer.type</span><span class="w">
</span></code></pre>
</div>

<div class="language-R highlighter-rouge"><pre class="highlight"><code><span class="n">head</span><span class="p">(</span><span class="n">golub.expr</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<h2 id="ttest-with-a-single-gene-step-by-step">2. t.test with a single gene (step-by-step)</h2>

<div class="language-R highlighter-rouge"><pre class="highlight"><code><span class="n">g</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">347</span><span class="w">
</span></code></pre>
</div>

<p>Alternatively, you can select a gene randomly</p>

<div class="language-R highlighter-rouge"><pre class="highlight"><code><span class="c1"># g &lt;- sample(1:nrow(golub.expr),1)
</span><span class="n">g.profile</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.vector</span><span class="p">(</span><span class="n">as.matrix</span><span class="p">(</span><span class="n">golub.expr</span><span class="p">[</span><span class="n">g</span><span class="p">,]))</span><span class="w">
</span></code></pre>
</div>

<p>Draw a barplot with color-coded cancer type</p>

<div class="language-R highlighter-rouge"><pre class="highlight"><code><span class="n">plot.col</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s1">'ALL'</span><span class="o">=</span><span class="s1">'lightblue'</span><span class="p">,</span><span class="w"> </span><span class="s1">'AML'</span><span class="o">=</span><span class="s1">'mediumpurple'</span><span class="p">)</span><span class="w">

</span><span class="n">barplot</span><span class="p">(</span><span class="n">g.profile</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="o">=</span><span class="n">paste</span><span class="p">(</span><span class="s2">"Golub (1999), gene"</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="p">),</span><span class="w">
        </span><span class="n">col</span><span class="o">=</span><span class="n">plot.col</span><span class="p">[</span><span class="n">cancer.type</span><span class="p">])</span><span class="w">
</span><span class="n">legend</span><span class="p">(</span><span class="s1">'topright'</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"ALL"</span><span class="p">,</span><span class="s2">"AML"</span><span class="p">),</span><span class="n">col</span><span class="o">=</span><span class="n">plot.col</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="s2">"ALL"</span><span class="p">,</span><span class="s2">"AML"</span><span class="p">)],</span><span class="w">
       </span><span class="n">pch</span><span class="o">=</span><span class="m">15</span><span class="p">,</span><span class="w"> </span><span class="n">bty</span><span class="o">=</span><span class="s2">"o"</span><span class="p">,</span><span class="w"> </span><span class="n">bg</span><span class="o">=</span><span class="s1">'white'</span><span class="p">)</span><span class="w">
</span><span class="n">box</span><span class="p">()</span><span class="w">
</span></code></pre>
</div>

<p>Separating the data in two vectors</p>

<div class="language-R highlighter-rouge"><pre class="highlight"><code><span class="n">sample.ALL</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">g.profile</span><span class="p">[</span><span class="n">cancer.type</span><span class="o">==</span><span class="s2">"ALL"</span><span class="p">]</span><span class="w">
</span><span class="n">sample.AML</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">g.profile</span><span class="p">[</span><span class="n">cancer.type</span><span class="o">==</span><span class="s2">"AML"</span><span class="p">]</span><span class="w">
</span></code></pre>
</div>

<p>**Compute manually ** the t test parameters (not necessary, just to practice!)</p>

<p>Estimate the population means</p>

<div class="language-R highlighter-rouge"><pre class="highlight"><code><span class="n">mean.est.ALL</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">sample.ALL</span><span class="p">)</span><span class="w">
</span><span class="n">mean.est.AML</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">sample.AML</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>Compute the sample standard deviations
The sd() function automatically computes the estimate corrected with sqrt(n-1)</p>

<div class="language-R highlighter-rouge"><pre class="highlight"><code><span class="n">sample.sd.ALL</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sd</span><span class="p">(</span><span class="n">sample.ALL</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">((</span><span class="n">n.ALL</span><span class="m">-1</span><span class="p">)</span><span class="o">/</span><span class="n">n.ALL</span><span class="p">)</span><span class="w">
</span><span class="n">sample.sd.AML</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sd</span><span class="p">(</span><span class="n">sample.AML</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">((</span><span class="n">n.AML</span><span class="m">-1</span><span class="p">)</span><span class="o">/</span><span class="n">n.AML</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>Estimate the population standard deviation</p>

<div class="language-R highlighter-rouge"><pre class="highlight"><code><span class="n">sd.est.ALL</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sd</span><span class="p">(</span><span class="n">sample.ALL</span><span class="p">)</span><span class="w">
</span><span class="n">sd.est.AML</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sd</span><span class="p">(</span><span class="n">sample.AML</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>Estimate the standard deviations on the means</p>

<div class="language-R highlighter-rouge"><pre class="highlight"><code><span class="n">sd.err.est.ALL</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sd</span><span class="p">(</span><span class="n">sample.ALL</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">(</span><span class="n">n.ALL</span><span class="p">)</span><span class="w">
</span><span class="n">sd.err.est.AML</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sd</span><span class="p">(</span><span class="n">sample.AML</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">(</span><span class="n">n.AML</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>Estimate the standard deviation of the difference between two means, according to Student’s formula</p>

<div class="language-R highlighter-rouge"><pre class="highlight"><code><span class="n">diff.sd.est</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">((</span><span class="n">n.ALL</span><span class="o">*</span><span class="n">sample.sd.ALL</span><span class="o">^</span><span class="m">2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">n.AML</span><span class="o">*</span><span class="n">sample.sd.AML</span><span class="o">^</span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="o">/</span><span class="n">n.ALL</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="o">/</span><span class="n">n.AML</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="p">(</span><span class="n">n.ALL</span><span class="o">+</span><span class="n">n.AML</span><span class="m">-2</span><span class="p">))</span><span class="w">
</span></code></pre>
</div>

<p>Compute t.obs</p>

<div class="language-R highlighter-rouge"><pre class="highlight"><code><span class="n">d</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">abs</span><span class="p">(</span><span class="n">mean.est.ALL</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">mean.est.AML</span><span class="p">)</span><span class="w">
</span><span class="n">t.obs.Student</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">diff.sd.est</span><span class="w">
</span></code></pre>
</div>

<p>Compute the P- vale.
Since we are performing the two-tail test, the single-tail probability has to be multiplied by 3 in order to obtai the alpha risk</p>

<div class="language-R highlighter-rouge"><pre class="highlight"><code><span class="n">P.val.Student</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">pt</span><span class="p">(</span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t.obs.Student</span><span class="p">,</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n.ALL</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">n.AML</span><span class="m">-2</span><span class="p">,</span><span class="w"> </span><span class="n">lower.tail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">F</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<h2 id="t-test-the-fast-way">3. T-test the fast way</h2>

<h3 id="this-is-what-you-should-be-doing">This is what you should be doing…</h3>

<h3 id="apply-the-student-fischer-t-test-this-assumes-that-the-two-populations-have-equal-variance">3.1 Apply the Student-Fischer t-test (this assumes that the two populations have equal variance).</h3>

<div class="language-R highlighter-rouge"><pre class="highlight"><code><span class="n">t.student</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">t.test</span><span class="p">(</span><span class="n">sample.ALL</span><span class="p">,</span><span class="n">sample.AML</span><span class="p">,</span><span class="w"> </span><span class="n">var.equal</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="n">print</span><span class="p">(</span><span class="n">t.student</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<h3 id="apply-the-welch-t-test-this-does-not-assume-that-the-two-populations-have-equal-variance">3.2 Apply the Welch t-test (this does not assume that the two populations have equal variance)</h3>

<div class="language-R highlighter-rouge"><pre class="highlight"><code><span class="n">t.welch</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">t.test</span><span class="p">(</span><span class="n">sample.ALL</span><span class="p">,</span><span class="n">sample.AML</span><span class="p">,</span><span class="w"> </span><span class="n">var.equal</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span><span class="n">print</span><span class="p">(</span><span class="n">t.welch</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

    </div>
  </div>
</html>
